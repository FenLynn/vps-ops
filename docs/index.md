# ğŸš€ VPS-Ops: ç”Ÿäº§çº§æœåŠ¡å™¨å…¨è‡ªåŠ¨éƒ¨ç½²æ–¹æ¡ˆ

<div align="center">

**é›¶åŸºç¡€ Â· å…¨è‡ªåŠ¨ Â· ç”šè‡³ä¸éœ€è¦å…¬ç½‘ IP**

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE) [![Docker](https://img.shields.io/badge/docker-compose-blue)](https://docs.docker.com/compose/) [![Cloudflare](https://img.shields.io/badge/cloudflare-zero--trust-orange)](https://www.cloudflare.com/)

</div>

---

## ğŸ“– è¿™æ˜¯ä¸€ä¸ªä»€ä¹ˆé¡¹ç›®ï¼Ÿ

æ‚¨æ˜¯å¦ç»å†è¿‡ï¼š

*   ä¹°äº†ä¸€å°æ–° VPSï¼Œè¦èŠ±åŠå¤©æ—¶é—´å®‰è£… Dockerã€é…ç½®é˜²ç«å¢™ã€ç”³è¯· SSL è¯ä¹¦ï¼Ÿ
*   æƒ³åœ¨æœåŠ¡å™¨ä¸Šè·‘ä¸ª AIï¼ˆOneAPIï¼‰æˆ–è€…ä»ªè¡¨ç›˜ï¼ˆHomarrï¼‰ï¼Œå´è¢« Nginx åå‘ä»£ç†æå¾—å¤´å¤§ï¼Ÿ
*   æœåŠ¡å™¨è£¸å¥”åœ¨å…¬ç½‘ï¼Œæ¯å¤©è¢«æ‰«æå‡ åä¸‡æ¬¡ï¼Œæå¿ƒåŠèƒ†ï¼Ÿ
*   æƒ³å¤‡ä»½æ•°æ®ï¼Œå´åªèƒ½æ‰‹åŠ¨æ‰“åŒ…ä¸‹è½½ï¼Œé‡è£…ç³»ç»Ÿåæ¢å¤æå…¶ç—›è‹¦ï¼Ÿ

**VPS-Ops å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜è€Œç”Ÿçš„ã€‚**

å®ƒæ˜¯ä¸€ä¸ª **"åŸºç¡€è®¾æ–½å³ä»£ç  (IaC)"** çš„è‡ªåŠ¨åŒ–è„šæœ¬ã€‚æ‚¨åªéœ€è¦å¡«å¥½å‡ ä¸ªå¯†ç ï¼Œè¿è¡Œä¸€æ¡å‘½ä»¤ï¼Œå®ƒå°±ä¼šåƒå˜é­”æœ¯ä¸€æ ·ï¼Œè‡ªåŠ¨æŠŠä¸€å°è¿˜æœ‰ä½™æ¸©çš„æ–° VPSï¼Œå˜æˆä¸€ä¸ª**å®‰å…¨ã€ç°ä»£ã€åŠŸèƒ½å¼ºå¤§**çš„ç§äººæ•°æ®ä¸­å¿ƒã€‚

---

## ï¸ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿï¼ˆåŸç†ç¯‡ï¼‰

ä¸ºäº†ä¿è¯ç¨³å®šå’Œæ˜“ç»´æŠ¤ï¼Œæˆ‘ä»¬å°†ç³»ç»Ÿåˆ†æˆäº†ä¸‰å±‚ï¼ˆè¿™ä¹Ÿæ˜¯æ‚¨ä¼šåœ¨æ–‡ä»¶å¤¹é‡Œçœ‹åˆ°çš„ç»“æ„ï¼‰ï¼š

```mermaid
graph TD
    User((ç”¨æˆ·)) --> CF[Cloudflare å…¨çƒè¾¹ç¼˜èŠ‚ç‚¹]
    CF --> Tunnel[ğŸ”’ å®‰å…¨éš§é“ (æ— éœ€å…¬ç½‘IP)]
    
    subgraph VPS [æ‚¨çš„æœåŠ¡å™¨]
        Tunnel --> Traefik[ç½‘å…³/TLS ç»ˆç»“]
        
        subgraph Layer0 [Layer 0: åŸºç¡€è®¾æ–½]
            ACME[acme.sh è¯ä¹¦è‡ªåŠ¨ç»­æœŸ]
            Watchtower[è‡ªåŠ¨æ›´æ–°]
        end
        
        subgraph Layer1 [Layer 1: æ ¸å¿ƒä¸šåŠ¡]
            NewAPI[AI æ¥å£ç½‘å…³]
            Uptime[ç›‘æ§é¢æ¿]
            Derp[Tailscale ä¸­ç»§]
        end
        
        subgraph Layer2 [Layer 2: ç®¡ç†é¢æ¿]
            Dockge[å®¹å™¨ç®¡ç†]
            Homarr[èšåˆå¯¼èˆªé¡µ]
        end
        
        subgraph Backup [ï¸ ç¾å¤‡ç³»ç»Ÿ]
            Kopia[Kopia å¢é‡å¤‡ä»½] --> WebDAV[â˜ï¸ äº‘ç«¯ç½‘ç›˜]
        end
    end
```

1.  **Layer 0 (åœ°åŸº)**ï¼šè´Ÿè´£è„æ´»ç´¯æ´»ã€‚è‡ªåŠ¨ç”³è¯· HTTPS è¯ä¹¦ã€å»ºç«‹ Cloudflare éš§é“ï¼ˆè®©å¤–ç½‘èƒ½å®‰å…¨è®¿é—®å†…ç½‘ï¼‰ã€è‡ªåŠ¨æ›´æ–°è½¯ä»¶ã€‚
2.  **Layer 1 (æ ¸å¿ƒ)**ï¼šæœ€é‡è¦çš„ä¸šåŠ¡ã€‚æ¯”å¦‚ AI æ¥å£(OneAPI)ã€ç›‘æ§(Uptime Kuma)ã€‚å®ƒä»¬æœ€å…ˆå¯åŠ¨ï¼Œæœ€åå…³é—­ã€‚
3.  **Layer 2 (ç®¡ç†)**ï¼šå¯è§†åŒ–çš„é¢æ¿ã€‚è®©æ‚¨é€šè¿‡æ¼‚äº®çš„ç½‘é¡µç®¡ç†æœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯å¯¹ç€é»‘æ¡†æ¡†æ•²å‘½ä»¤ã€‚

---

## ï¸ å‡†å¤‡å·¥ä½œ

åœ¨å¼€å§‹ä¹‹å‰ï¼Œæ‚¨éœ€è¦å‡†å¤‡ä»¥ä¸‹ 4 æ ·ä¸œè¥¿ï¼ˆå°±åƒç‚’èœå‰è¦å¤‡æ–™ï¼‰ï¼š

1.  **ä¸€å° VPS**ï¼š
    *   æ¨èé…ç½®ï¼š2æ ¸ 2G å†…å­˜ä»¥ä¸Šï¼ˆè™½ç„¶ 1æ ¸1G ä¹Ÿèƒ½è·‘ï¼Œä½†æœ‰ç‚¹å‹‰å¼ºï¼‰ã€‚
    *   ç³»ç»Ÿï¼šæ¨è **Debian 11/12** æˆ– Ubuntu 20.04/22.04ï¼ˆCentOS ä¹Ÿå¯ä»¥ï¼Œä½†ç¨å¾®éº»çƒ¦ç‚¹ï¼‰ã€‚
2.  **ä¸€ä¸ªåŸŸå**ï¼š
    *   å¿…é¡»æ‰˜ç®¡åœ¨ **Cloudflare**ï¼ˆå› ä¸ºæˆ‘ä»¬éœ€è¦å®ƒçš„ API æ¥è‡ªåŠ¨ç”³è¯·è¯ä¹¦ï¼‰ã€‚
3.  **Cloudflare è´¦å·**ï¼š
    *   ç”¨äºåˆ›å»º **Tunnel**ï¼ˆéš§é“ï¼‰ã€‚è¿™æ˜¯æœ¬é¡¹ç›®çš„æ ¸å¿ƒï¼Œå®ƒèƒ½è®©æ‚¨çš„æœåŠ¡åœ¨ä¸å¼€æ”¾ 80/443 ç«¯å£çš„æƒ…å†µä¸‹è¢«å¤–ç½‘è®¿é—®ï¼Œæå…¶å®‰å…¨ã€‚
4.  **WebDAV ç½‘ç›˜**ï¼ˆå¯é€‰ï¼Œä½†å¼ºçƒˆæ¨èï¼‰ï¼š
    *   æ¨è **TeraCloud** (å…è´¹ 10GB) æˆ–åšæœäº‘ã€‚ç”¨äºå­˜æ”¾æ¯æ—¥è‡ªåŠ¨å¤‡ä»½çš„æ•°æ®ã€‚

---

## âš¡ï¸ æé€Ÿå®‰è£…æŒ‡å—

### ç¬¬ä¸€æ­¥ï¼šè·å–ä»£ç 
ç™»å½•æ‚¨çš„ VPSï¼ˆæ¨èä½¿ç”¨ SSH å·¥å…·ï¼‰ï¼Œè¾“å…¥ï¼š

```bash
# 1. å®‰è£… git (å¦‚æœå·²å®‰è£…å¯è·³è¿‡)
apt update && apt install -y git  # Debian/Ubuntu
# yum install -y git              # CentOS

# 2. ä¸‹è½½æœ¬é¡¹ç›®
git clone https://github.com/FenLynn/vps-ops.git
cd vps-ops
```

### ç¬¬äºŒæ­¥ï¼šé…ç½®â€œç§˜å¯†æ–‡ä»¶â€ (.env)
è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚æˆ‘ä»¬éœ€è¦å‘Šè¯‰è„šæœ¬æ‚¨çš„å¯†ç å’Œ Tokenã€‚

```bash
# å¤åˆ¶æ¨¡æ¿æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘å®ƒ (å°ç™½æ¨èä½¿ç”¨ nanoï¼Œæˆ–è€…åœ¨æœ¬åœ°æ”¹å¥½ä¼ ä¸Šå»)
nano .env
```

**æ‚¨åªéœ€é‡ç‚¹å…³æ³¨è¿™å‡ é¡¹ï¼ˆå¡«é”™ä¼šå¯¼è‡´æœåŠ¡æ— æ³•å¯åŠ¨ï¼‰ï¼š**

| å˜é‡å | å¿…å¡« | ä½œç”¨ | è·å–æ–¹å¼ |
| :--- | :--- | :--- | :--- |
| `CF_TOKEN` | âœ… | Cloudflare éš§é“çš„èº«ä»½è¯ | [Cloudflare Zero Trust](https://one.dash.cloudflare.com/) -> Networks -> Tunnels -> Create |
| `CF_DNS_API_TOKEN` | âœ… | ç”³è¯· SSL è¯ä¹¦çš„æƒé™ | [Cloudflare API](https://dash.cloudflare.com/profile/api-tokens) -> Create -> Edit zone DNS |
| `KOPIA_PASSWORD` | âœ… | æ•°æ®å¤‡ä»½çš„åŠ å¯†å¯†ç  | **è‡ªå·±è®¾å®š**ï¼ˆä¸€å®šè¦å¤æ‚ï¼ä¸¢äº†æ•°æ®æ‰¾ä¸å›ï¼ï¼‰ |
| `WEBDAV_URL` | âœ… | å¤‡ä»½ä¼ åˆ°å“ªé‡Œå» | æ‚¨çš„ç½‘ç›˜ WebDAV åœ°å€ |
| `NEW_API_ADMIN_PASSWORD` | âœ… | AI é¢æ¿çš„ç®¡ç†å‘˜å¯†ç  | **è‡ªå·±è®¾å®š** |

*(è¯¦ç»†çš„ Token è·å–å›¾æ–‡æ•™ç¨‹ï¼Œè¯·çœ‹æœ¬æ–‡æœ«å°¾çš„é™„å½•)*

### ç¬¬ä¸‰æ­¥ï¼šä¸€é”®å‘å°„ ğŸš€
ç¡®è®¤ `.env` æ²¡é—®é¢˜åï¼Œæ·±å¸ä¸€å£æ°”ï¼Œæ‰§è¡Œï¼š

```bash
sudo bash init_host.sh
```

**æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ**

1.  **ç³»ç»Ÿåˆå§‹åŒ–**ï¼šè„šæœ¬ä¼šä¼˜åŒ–å†…æ ¸å‚æ•°ï¼Œå®‰è£… Dockerï¼Œåˆ›å»ºä¸€ä¸ªå« `sudor` çš„å®‰å…¨ç”¨æˆ·ã€‚
2.  **ç½‘ç»œä¼˜åŒ–**ï¼šè‡ªåŠ¨é…ç½®å›½å†…é•œåƒæºï¼Œå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæ‹‰å–é•œåƒå¡åœ¨ 0% äº†ã€‚
3.  **å¯åŠ¨æœåŠ¡**ï¼šä¾æ¬¡å¯åŠ¨ Layer 0, 1, 2 çš„æ‰€æœ‰æœåŠ¡ã€‚
4.  **è‡ªåŠ¨æ¢å¤**ï¼šå¦‚æœæ˜¯æ–°æœºå™¨ä¸”é…ç½®äº†å¤‡ä»½ï¼Œå®ƒç”šè‡³ä¼šè‡ªåŠ¨ä»ç½‘ç›˜æŠŠä»¥å‰çš„æ•°æ®æ‹‰å›æ¥ï¼

å–æ¯å’–å•¡ï¼Œç­‰å¾…å‡ºç° **"âœ… All systems functional!"** å­—æ ·ã€‚

---

## ğŸ–¥ï¸ å¦‚ä½•è®¿é—®æˆ‘çš„æœåŠ¡ï¼Ÿ

å®‰è£…å®Œæˆåï¼Œæ‚¨å¯èƒ½ä¼šé—®ï¼šâ€œIP:ç«¯å£ æ€ä¹ˆè®¿é—®ä¸äº†ï¼Ÿâ€
**æ˜¯çš„ï¼Œä¸ºäº†å®‰å…¨ï¼Œæˆ‘ä»¬é»˜è®¤å…³é—­äº†æ‰€æœ‰ç«¯å£ï¼ˆåªç•™äº† SSHï¼‰ï¼**

è¯·å» Cloudflare Zero Trust åå°ï¼Œé…ç½® **Public Hostnames**ï¼š

| æœåŠ¡åç§° | å»ºè®®å­åŸŸå | å®¹å™¨å†…éƒ¨åœ°å€ (Service) |
| :--- | :--- | :--- |
| **New API (AI)** | `api.yourdomain.com` | `http://new-api:3000` |
| **Uptime Kuma** | `status.yourdomain.com` | `http://uptime-kuma:3001` |
| **Dockge (ç®¡ç†)** | `dockge.yourdomain.com` | `http://dockge:5001` |
| **Homarr (å¯¼èˆª)** | `home.yourdomain.com` | `http://homarr:7575` |

**ğŸ’¡ å®‰å…¨å°è´´å£«**ï¼šå¯¹äº `dockge` å’Œ `homarr` è¿™ç§ç®¡ç†åå°ï¼Œå¼ºçƒˆå»ºè®®åœ¨ Cloudflare æ˜¯å¼€å¯ **Access**ï¼ˆèº«ä»½éªŒè¯ï¼‰ï¼Œè¿™æ ·åˆ«äººè®¿é—®æ—¶éœ€è¦è¾“å…¥é‚®ç®±éªŒè¯ç ï¼Œå®‰å…¨æ€§ MAXï¼

---

## ğŸ›¡ï¸ å…³äºæ•°æ®å¤‡ä»½ (å°ç™½å¿…è¯»)

æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯ **ä¼ä¸šçº§** çš„ Kopia å¤‡ä»½æ–¹æ¡ˆã€‚

*   **å®ƒå­˜å“ªäº†ï¼Ÿ** æ‚¨é…ç½®çš„ WebDAV ç½‘ç›˜ã€‚
*   **å­˜äº†ä»€ä¹ˆï¼Ÿ** æ‚¨çš„æ‰€æœ‰é…ç½®ã€æ•°æ®åº“ã€è¯ä¹¦ã€‚ä¸åŒ…å«ä»£ç ï¼ˆä»£ç åœ¨ git é‡Œï¼‰ã€‚
*   **å®‰å…¨å—ï¼Ÿ** æå…¶å®‰å…¨ã€‚æ•°æ®åœ¨ç¦»æœåŠ¡å™¨å‰å°±è¢«åŠ å¯†äº†ï¼Œç½‘ç›˜ç®¡ç†å‘˜ä¹Ÿçœ‹ä¸äº†ã€‚
*   **æ€ä¹ˆæ¢å¤ï¼Ÿ**

    *   **è‡ªåŠ¨**ï¼šæ–°æœºå™¨å¡«å¥½ `.env` è¿è¡Œè„šæœ¬ï¼Œè‡ªåŠ¨æ¢å¤ã€‚
    *   **æ‰‹åŠ¨**ï¼š
        ```bash
        # æƒ³å›æ»šåˆ°æ˜¨å¤©çš„çŠ¶æ€ï¼Ÿ
        docker exec -it kopia kopia snapshot restore latest /source
        ```

---

## â“ å¸¸è§é—®é¢˜ (Q&A)

**Q: è„šæœ¬è¿è¡Œåˆ°ä¸€åŠæ–­å¼€äº†æ€ä¹ˆåŠï¼Ÿ**
A: æ²¡äº‹ï¼Œç›´æ¥é‡æ–°è¿è¡Œ `sudo bash init_host.sh`ã€‚è„šæœ¬æ˜¯â€œå¹‚ç­‰â€çš„ï¼Œæ„æ€æ˜¯è¿è¡Œ 1 æ¬¡å’Œè¿è¡Œ 100 æ¬¡æ•ˆæœä¸€æ ·ï¼Œä¸ä¼šç ´åç°æœ‰æ•°æ®ã€‚

**Q: è¯ä¹¦ç”³è¯·å¤±è´¥äº†ï¼Ÿ**
A: æ£€æŸ¥ `CF_DNS_API_TOKEN` æ˜¯å¦æœ‰å¤šä½™ç©ºæ ¼ï¼ŸCloudflare å¶å°”ä¼šæŠ½é£ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—ï¼š`docker logs acme-init`ã€‚

**Q: æˆ‘æƒ³ä¿®æ”¹ç«¯å£ï¼Ÿ**
A: ç¼–è¾‘ `config.ini` æ–‡ä»¶ï¼Œç„¶åé‡æ–°è¿è¡Œè„šæœ¬å³å¯ã€‚

---


---

## ğŸ“š é™„å½•ï¼šToken è·å–æ‰‹æŠŠæ‰‹æ•™ç¨‹

### 1. Cloudflare Tunnel Token (å†…ç½‘ç©¿é€)
**è¿™æ˜¯ä»€ä¹ˆï¼Ÿ** å®ƒåƒä¸€æ¡ç§˜å¯†åœ°é“ï¼Œè®©å…¨ä¸–ç•Œèƒ½è®¿é—®æ‚¨çš„æœåŠ¡ï¼Œä½†åˆä¸éœ€è¦æ‚¨åœ¨é˜²ç«å¢™ä¸Šå¼€æ´ã€‚
1.  æ‰“å¼€ [Zero Trust Dashboard](https://one.dash.cloudflare.com/)ã€‚
2.  ç‚¹å‡»å·¦ä¾§ **Networks** -> **Tunnels**ã€‚
3.  ç‚¹å‡» **Create a tunnel**ã€‚
4.  éšä¾¿èµ·ä¸ªåï¼ˆæ¯”å¦‚ `vps-ops`ï¼‰ï¼Œä¿å­˜ã€‚
5.  åœ¨ "Choose your environment" é€‰ **Docker**ã€‚
6.  ä¸‹é¢ä¼šå‡ºç°ä¸€ä¸²å‘½ä»¤ï¼Œæ‰¾åˆ° `--token` åé¢çš„é‚£ä¸²ä¹±ç ï¼Œå¤åˆ¶å®ƒã€‚
    *   è¿™å°±æ˜¯ `CF_TOKEN`ã€‚

### 2. Cloudflare DNS API Token (è¯ä¹¦ç”³è¯·)
**è¿™æ˜¯ä»€ä¹ˆï¼Ÿ** å®ƒæ˜¯ç»™è‡ªåŠ¨åŒ–è„šæœ¬çš„â€œæˆæƒä¹¦â€ï¼Œå…è®¸è„šæœ¬è¯æ˜â€œè¿™ä¸ªåŸŸåæ˜¯æˆ‘çš„â€ï¼Œä»è€Œç”³è¯· SSL è¯ä¹¦ã€‚
1.  æ‰“å¼€ [API Tokens é¡µé¢](https://dash.cloudflare.com/profile/api-tokens)ã€‚
2.  ç‚¹å‡» **Create Token**ã€‚
3.  æ‰¾åˆ° **Edit zone DNS** æ¨¡æ¿ï¼Œç‚¹å‡» **Use template**ã€‚
4.  **Zone Resources** é€‰ **Include** -> **Specific zone** -> **æ‚¨çš„åŸŸå**ã€‚
5.  ç‚¹å‡» **Continue to summary** -> **Create Token**ã€‚
6.  å¤åˆ¶é‚£ä¸ªåªæ˜¾ç¤ºä¸€æ¬¡çš„ Tokenã€‚
    *   è¿™å°±æ˜¯ `CF_DNS_API_TOKEN`ã€‚

### 3. Kopia Repository Password (å¤‡ä»½å¯†ç )
**è¿™æ˜¯ä»€ä¹ˆï¼Ÿ** è¿™æ˜¯æ‚¨æ•°æ®çš„â€œä¿é™©ç®±å¯†ç â€ã€‚
*   **è·å–æ–¹å¼**ï¼š**ä¸éœ€è¦è·å–ï¼Œç”±æ‚¨è‡ªå·±æƒ³ä¸€ä¸ªï¼**
*   **è¦æ±‚**ï¼šè¶Šé•¿è¶Šå¥½ï¼ŒåŒ…å«å¤§å°å†™ã€æ•°å­—ã€ç¬¦å·ã€‚
*   **æ³¨æ„**ï¼š**åƒä¸‡åˆ«ä¸¢ï¼åƒä¸‡åˆ«ä¸¢ï¼** è¿™ä¸ªå¯†ç ä¸å­˜æœåŠ¡å™¨ï¼Œåªå­˜æ‚¨çš„è„‘å­é‡Œã€‚å¦‚æœ‰ä¸¢å¤±ï¼Œç¥ä»™éš¾æ•‘ã€‚

### 4. New API Admin Password
**è¿™æ˜¯ä»€ä¹ˆï¼Ÿ** AI æ¥å£ç®¡ç†é¢æ¿çš„è¶…çº§ç®¡ç†å‘˜å¯†ç ã€‚
*   **è·å–æ–¹å¼**ï¼š**ç”±æ‚¨è‡ªå·±è®¾å®š**ã€‚ç³»ç»Ÿå¯åŠ¨åï¼Œè¿™å°±æ˜¯æ‚¨ç™»å½• `api.yourdomain.com` çš„å¯†ç ï¼ˆè´¦å·æ˜¯ rootï¼‰ã€‚

---

<div align="center">

**Enjoy your new server! ğŸ¥‚**

Made with â¤ï¸ by FenLynn

</div>
