# =============================================================================
# VPS-OPS — Nginx Relay 日志轮转配置
# 部署路径: /etc/logrotate.d/vps-nginx
# 说明: nginx-relay 容器将日志写入宿主机 ${BASE_DIR}/logs/nginx/
#       该目录通过 volume 挂载，不受 Docker logging driver 控制，
#       必须由宿主机 logrotate 单独管理。
# =============================================================================
/opt/vps-dmz/logs/nginx/*.log {
    daily           # 每天轮转
    rotate 7        # 保留最近 7 份（约 7 天）
    compress        # gzip 压缩旧文件
    delaycompress   # 最新的旧文件不压缩（nginx 可能还在写）
    missingok       # 文件不存在时不报错
    notifempty      # 空文件不轮转
    sharedscripts   # 所有匹配的文件共享同一组脚本
    postrotate
        # 通知 nginx 容器重新打开日志文件句柄（不重启服务）
        docker exec nginx-relay nginx -s reopen 2>/dev/null || true
    endscript
}
